<h2 mat-dialog-title>Nota de crédito</h2>

<mat-dialog-content class="flex flex-col gap-4">

  <p class="text-sm text-gray-600">
    Selecciona cómo deseas generar la nota de crédito
  </p>

  <!-- OPCIÓN PRINCIPAL -->
  <mat-radio-group [(ngModel)]="opcion" (ngModelChange)="onOpcionChange()" class="flex flex-col gap-2">
    <mat-radio-button value="DEVOLUCION">
      Devolución
    </mat-radio-button>

    <mat-radio-button value="DESCUENTO">
      Descuento
    </mat-radio-button>
  </mat-radio-group>

  <!-- DEVOLUCIÓN: total / parcial -->
  <ng-container *ngIf="opcion === 'DEVOLUCION'">
    <div class="pt-2 border-t border-gray-200"></div>

    <p class="text-sm text-gray-600">
      Selecciona el tipo de devolución
    </p>

    <mat-radio-group [(ngModel)]="tipoDevolucion" class="flex flex-col gap-2">
      <mat-radio-button value="TOTAL">
        Devolución total
      </mat-radio-button>

      <mat-radio-button value="PARCIAL">
        Devolución parcial
      </mat-radio-button>
    </mat-radio-group>

    <p class="text-xs text-gray-500 m-0">
      La siguiente pantalla se adaptará según si la devolución es total o parcial.
    </p>
  </ng-container>

  <!-- DESCUENTO: monto -->
  <ng-container *ngIf="opcion === 'DESCUENTO'">
  <div class="pt-2 border-t border-gray-200"></div>

  <p class="text-sm text-gray-600">
    Captura el importe del descuento
  </p>

  <div class="mt-2 flex flex-col gap-3 rounded-lg border border-gray-200 p-3">

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Importe a acreditar</mat-label>
      <input
        matInput
        type="number"
        min="0"
        step="0.01"
        [(ngModel)]="montoDescuento"
        (ngModelChange)="onMontoChange()"
        placeholder="0.00" />

      <mat-hint>
        Máximo: {{ maxDescuento | number:'1.2-2' }}
      </mat-hint>

      <mat-error *ngIf="montoDescuento != null && montoDescuento > maxDescuento">
        El importe no puede ser mayor al total de la factura.
      </mat-error>

      <mat-error *ngIf="montoDescuento != null && montoDescuento <= 0">
        Captura un importe mayor a 0.
      </mat-error>
    </mat-form-field>

  </div>
</ng-container>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()" [disabled]="isLoading">Cancelar</button>

  <button
    mat-raised-button
    color="primary"
    [disabled]="!canSubmit() || isLoading"
    (click)="continuar()">

    <ng-container *ngIf="!isLoading; else loadingTpl">
      {{ getPrimaryActionLabel() }}
    </ng-container>

    <ng-template #loadingTpl>
      Procesando...
    </ng-template>

  </button>
</mat-dialog-actions>